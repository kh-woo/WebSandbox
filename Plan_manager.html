<!DOCTYPE html>
<html>

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="plan_manager.css">

    <title>Plan-Manager</title>
</head>

<body>
    <!-- HTML Code -->
    <nav class="navbar bg-body-tertiary">
        <div class="container">
            <span class="navbar-brand mb-0 h1">
                <i class="bi bi-card-checklist"></i>
                나만의 Plan-Manager</span>
        </div>
    </nav>

    <!-- 오른쪽 상단 작은 입력 필드 -->
    <div class="top-right-input">
        <div class="container">
            여러분만의 계획을 설정하고<br> 완료 시 표시가 가능한 Planmanager입니다.<br>
            각 계획마다 우선 순위를 부여할 수 있으므로<br> 입력할 계획 옆에 체크박스로 표시한 후<br> 계획을 등록하세요 !
        </div>
    </div>

    <div class="container">
        <div class="d-flex align-items-center my-1"><!--Top, Botoom Margin is my-1-->>
            <input type="text" class="form-control" id="plan-input" placeholder="Enter a plan here"><!-- 입력받는 곳-->
            <div class="btn-group ms-2" role="group" aria-label="Priority selection"><!--우선순위 선택하는 곳-->
                <input type="checkbox" class="btn-check" id="priority-high" autocomplete="off">
                <label class="btn btn-outline-danger" for="priority-high">High</label>

                <input type="checkbox" class="btn-check" id="priority-medium" autocomplete="off">
                <label class="btn btn-outline-warning" for="priority-medium">Medium</label>

                <input type="checkbox" class="btn-check" id="priority-low" autocomplete="off">
                <label class="btn btn-outline-success" for="priority-low">Low</label>
            </div>
            <button type="button" id="add-btn" class="btn btn-primary ms-1 text-nowrap">
                <i class="bi bi-plus"></i>
                Add
            </button>
        </div>
        <!--Todo, Done-->
        <div class="d-flex">
            <div class="flex-grow-1 rounded-2 p-2 me-1 w-50">
                <h3>Plans</h3>
                <div id="plan-list"></div>
            </div>

            <div class="flex-grow-1 rounded-2 p-2 w-50">
                <h3>Done</h3>
                <div id="done-list"></div>
            </div>
        </div>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

        <script>
            /* JS Code */
            const Type = { // Object
                Todo: 1,
                Done: 2,
            };

            const PriorityColors = {//우선순위 색상
                High: "#FBB4AE",
                Medium: "#FFFFCC",
                Low: "#CCEBC5"
            };

            let plans = [];//저장된 plan을 담는 배열

            function loadPlans() {
                let lastPlans = localStorage.getItem("plans");
                if (!lastPlans) return;

                plans = JSON.parse(lastPlans);
                plans.forEach(p => {
                    addToList(p);
                });
            }

            function savePlans() {
                localStorage.setItem("plans", JSON.stringify(plans));
            }

            //리스트에 계획 추가
            function addToList(plan) {
                let div = document.createElement("div");
                div.className = "plan p-1 rounded-2 ps-2 d-flex align-items-center";
                div.style.backgroundColor = plan.color;//우선순위에 맞춰서 배경색 설정

                let span = document.createElement("span");
                span.classList.add("me-auto");
                span.textContent = plan.text;
                div.appendChild(span);

                if (plan.type === Type.Todo) {
                    //완료버튼 생성
                    let buttonDone = document.createElement("button");
                    buttonDone.classList.add("btn", "btn-sm", "btn-success", "me-1");
                    buttonDone.innerHTML = '<i class="bi bi-check"></i>';
                    div.appendChild(buttonDone);

                    //완료버튼 클릭 시, Done으로 이동
                    buttonDone.addEventListener("click", () => {
                        div.remove();//현재 항목을 Plans에서 제거
                        plan.type = Type.Done;//상태를 Done으로 변경
                        plans = plans.filter(p => p !== plan);//Plans 배열에서 제거
                        plans.push(plan);//Done 항목에 추가
                        savePlans();
                        addToList(plan);//Done 리스트에 추가
                    });
                }

                //삭제버튼 생성
                let buttonRemove = document.createElement("button");
                buttonRemove.classList.add("btn", "btn-sm", "btn-danger");
                let iElem = document.createElement("i");
                iElem.classList.add("bi", "bi-x");
                buttonRemove.appendChild(iElem);
                div.appendChild(buttonRemove);

                //삭제버튼 클릭 시 발생하는 이벤트
                buttonRemove.addEventListener("click", () => {
                    div.remove();//화면에서 제거
                    plans = plans.filter(p => p !== plan);//plans 배열에서 제거
                    savePlans();
                });

                //상태에 따라 Todo or Done 리스트에 추가
                let list = document.querySelector(plan.type === Type.Todo ? "#plan-list" : "#done-list");
                list.appendChild(div);
            }

            let addBtn = document.querySelector("#add-btn");
            addBtn.addEventListener("click", () => {
                let input = document.querySelector("#plan-input");

                let text = input.value;
                if (!text.length) return;

                //우선순위 확인 및 색상 설정
                let color = "";
                if (document.querySelector("#priority-high").checked) color = PriorityColors.High;
                else if (document.querySelector("#priority-medium").checked) color = PriorityColors.Medium;
                else if (document.querySelector("#priority-low").checked) color = PriorityColors.Low;

                let plan = {//새 계획 객체 생성
                    text: text,
                    color: color,
                    type: Type.Todo
                };
                plans.push(plan);
                savePlans();
                addToList(plan);
                input.value = "";//입력 초기화

                //우선순위 초기화
                document.querySelectorAll(".btn-check").forEach(btn => btn.checked = false);
            });

            window.addEventListener("load", () => {
                loadPlans();
            });
        </script>

        <!-- 사이드바 -->
        <div class="side-bar">
            <div class="links">
                <ul>
                    <li><a href="index.html" style="color:white; text-decoration:none;">홈페이지</a></li>
                </ul>
            </div>
            <div class="footer-links">
                <a href="https://www.kw.ac.kr" target="_blank">광운대학교 홈페이지</a>
                <a href="https://sw.kw.ac.kr" target="_blank">인융대 홈페이지</a>
            </div>
        </div>
</body>

</html>